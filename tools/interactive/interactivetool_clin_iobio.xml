<tool id="interactive_tool_clin_iobio" tool_type="interactive" name="clin.iobio visualisation" version="v3.2.4">
    <requirements>
	    <container type="docker">clintest</container>
    </requirements>
    <entry_points>
        <entry_point name="Clin io.bio visualisation" requires_domain="True">
            <port>4030</port>
            <url><![CDATA[
/genes=${genes}&species=Human&build=${refgen_version}&affectedSibs=&unaffectedSibs=&rel0=proband&sex0=${proband_sex}&vcf0=http://localhost:4030/galaxy/vcf0.vcf&tbi0=http://localhost:4030/galaxy/vcf0.vcf.tbi&bam0=http://localhost:4030/galaxy/bam0.bam&bai0=http://localhost:4030/galaxy/bam0.bam.bai&sample0=proband&affectedStatus0=${proband_affected}
#if str($input_type.input_type_selector) == "trio"
&rel1=father&sex1=male&vcf1=vcf1.vcf&tbi1=vcf1.vcf.tbi&bam1=bam1.bam&bai1=bam1.bam.bai&sample1=father&affectedStatus1=${input_type.father.affected}&rel2=mother&sex2=female&vcf2=vc2.vcf&tbi2=vcf2.vcf.tbi&bam2=bam2.bam&bai2=bam2.bam.bai&sample2=mother&affectedStatus2=${input_type.mother.affected}
#end if
            ]]></url>
        </entry_point>
    </entry_points>
    <!--<configfiles>
        <configfile name="clinconfig"><![CDATA[
#PROJECT_NAME: Demo project
#PROJECT_DESCRIPTION: Exome sequencing project for four samples.
#BED_URL: https://iobio.s3.amazonaws.com/clin.iobio/20130108.exome.targets.bed
#BUILD: GRCh37
ID,SAMPLE_ID,PATERNAL_ID,MATERNAL_ID,SEX,AFFECTED_STATUS,RELATION,VCF_URL,TBI_URL,BAM_URL,BAI_URL
1,NA12878,NA12891,NA12892,1,2,proband,https://s3.amazonaws.com/iobio/samples/vcf/platinum-exome.vcf.gz,,https://s3.amazonaws.com/iobio/samples/bam/NA12878.exome.bam,
1,NA12877,NA12891,NA12892,2,1,sibling,https://s3.amazonaws.com/iobio/samples/vcf/platinum-exome.vcf.gz,,https://s3.amazonaws.com/iobio/samples/bam/NA12877.exome.bam,
1,NA12891,0,0,1,1,father,https://s3.amazonaws.com/iobio/samples/vcf/platinum-exome.vcf.gz,,https://s3.amazonaws.com/iobio/samples/bam/NA12892.exome.bam,
1,NA12892,0,0,2,1,mother,https://s3.amazonaws.com/iobio/samples/vcf/platinum-exome.vcf.gz,,https://s3.amazonaws.com/iobio/samples/bam/NA12891.exome.bam,
        ]]></configfile>
    </configfiles>-->
    <command><![CDATA[
    #import os
    cp ${proband_vcf} vcf0.vcf &&
    cp ${proband_vcf.metadata.tabix_index} vcf0.vcf.tbi &&
    cp ${proband_bam} bam0.bam &&
    cp ${proband_bam.metadata.bam_index} bam0.bam.bai &&
#if str($input_type.input_type_selector) == "trio"
    cp ${input_type.father.vcf} vcf1.vcf &&
    cp ${input_type.father.vcf.metadata.tabix_index} vcf1.vcf.tbi &&
    cp ${input_type.father.bam} bam1.bam &&
    cp ${input_type.father.bam.metadata.bam_index} bam1.bam.bai &&
    cp ${input_type.mother.vcf} vcf2.vcf &&
    cp ${input_type.mother.vcf.metadata.tabix_index} vcf2.vcf.tbi &&
    cp ${input_type.mother.bam} bam2.bam &&
    cp ${input_type.mother.bam.metadata.bam_index} bam2.bam.bai &&
#end if
ln -s \$PWD /usr/share/nginx/html/galaxy &&
nginx -g 'daemon off;'
]]>
    </command>
    <inputs>
        <param name="proband_bam" type="data" format="bam,cram" label="Proband BAM file"/>
        <param name="proband_vcf" type="data" format="vcf,vcf_bgzip" label="Proband VCF file"/>
        <param name="proband_sex" type="select" display="radio" label="Proband sex">
            <option value="male" selected="true">Male</option>
            <option value="female">Female</option>
        </param>
        <param name="proband_affected" type="boolean" truevalue="affected" falsevalue="unaffected" checked="true" label="Is the proband affected?"/>
        <conditional name="input_type">
            <param name="input_type_selector" type="select" display="radio" label="Single/Trio analysis">
                <option value="single" selected="true">Single</option>
                <option value="trio">Trio</option>
            </param>
            <when value="trio">
                <section name="father" title="Father input">
                    <param name="bam" type="data" format="bam,cram" label="Father BAM file"/>
                    <param name="vcf" type="data" format="vcf,vcf_bgzip" label="Father VCF file"/>
                    <param name="affected" type="boolean" truevalue="affected" falsevalue="unaffected" checked="false" label="Is the father affected?"/>
                </section>
                <section name="mother" title="Mother input">
                    <param name="bam" type="data" format="bam,cram" label="Mother BAM file"/>
                    <param name="vcf" type="data" format="vcf,vcf_bgzip" label="Mother VCF file"/>
                    <param name="affected" type="boolean" truevalue="affected" falsevalue="unaffected" checked="false" label="Is the mother affected?"/>
                </section>
            </when>
        </conditional>
        <param name="genes" type="text" value="PDHA1,ARHGAP8,RAI1,PLXNA1,SCN8A,SMARCA2" size="100x5" label="Genes of interest" help=""/>
        <param name="refgen_version" type="select" label="Select reference genome version">
            <option value="GRCh38" selected="true">GRCh38</option>
            <option value="GRCh37">GRCh37</option>
        </param>
    </inputs>
    <outputs>
        <data name="outfile" format="txt" />
    </outputs>
    <tests>
    </tests>
    <help><![CDATA[
    Clin.iobio provides a comprehensive and guided workflow to review sequencing data and report impactful variants. Clin.iobio also helps prioritize variants based on multiple integrated gene:disease association algorithms and knowledge bases.

    Required inputs:

    1. Proband BAM file
    2. Proband VCF file

    Optional inputs (trio analysis):

    1. Father & Mother BAM file
    2. Father & Mother VCF file

    The `iobio project`_ is developed by the `Marth lab`_ at the `University of Utah Center for Genetic Discovery`_.

    .. _iobio project: https://iobio.io
    .. _Marth lab: https://marthlab.org/
    .. _University of Utah Center for Genetic Discovery: https://ucgd.genetics.utah.edu/
    ]]></help>
</tool>
